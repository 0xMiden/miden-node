# Miden node

This crate contains a binary for running a Miden rollup faucet.

## Running the faucet

1. Run a local node using the docker image. From the "miden-node" repo root run the following commands:
```bash
make docker-build-node
make docker-run-node
```

2. Install the faucet:
```bash
make install-faucet
```

3. [Optional] Create faucet account (skip this step if you want to use an account from the genesis). This will generate authentication keypair and generate and write public faucet account data with its keypair into the file specified in `output-path`:

```bash
miden-faucet create-faucet-account \
  --output-path <path to faucet.mac> \
  --token-symbol MIDEN \
  --decimals 6 \
  --max-supply 100000000000000000
```
> [!TIP]
> This account will not be created on chain yet, creation on chain will happen on the first minting transaction.

4. Create the default faucet configuration file. Specify the path to the faucet account file created on the previous step in the `-f` flag (if you want to use an account from the genesis, specify the path to the `faucet.mac` file generated by the [make-genesis](../../README.md#setup) command of the Miden node):
```bash
miden-faucet init -f <path to faucet.mac>
```

5. Start the faucet server:
```bash
miden-faucet start
```

After a few seconds you may go to `http://localhost:8080` and see the faucet UI.


## Faucet security features:
The faucet implements several security measures to prevent abuse:

1. **Rate Limiting**:
   - IP-based rate limiting:
     - Burst limit: 8 requests
     - Sustained rate: 1 request per second
   - Account-based rate limiting:
     - Burst limit: 1 request
     - Sustained rate: 10 requests per second
   - Request queue size: 1000 concurrent requests
   - Request timeout: 10 seconds

2. **Proof of Work requests**:
  - Users must complete a computational challenge before their request is processed
  - The challenge difficulty can be adjusted

3. **Requests batching**:
  - Maximum batch size: 100 requests
  - Requests are processed in batches to optimize performance
  - Failed requests within a batch are handled individually

4. **Account rollbacks**:
  - Faucet maintains the last 1000 account states for potential rollbacks
  - Is used in case a desync is detected


## License
This project is [MIT licensed](../../LICENSE).
